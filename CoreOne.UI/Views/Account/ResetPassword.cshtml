<div class="container mt-4">
    <h4>Reset Password</h4>
    <input type="password" id="newPwd" class="form-control mb-2" placeholder="New password" />
    <button id="btnReset" class="btn btn-success">Reset</button>
    <div id="timer" class="mt-2 text-danger"></div>
</div>

<script>
    const token = new URLSearchParams(window.location.search).get('token');
    let remaining = 600;
    const timer = setInterval(()=>{
      let m = Math.floor(remaining/60), s = remaining%60;
      $("#timer").text(`Link expires in ${m}:${s.toString().padStart(2,'0')}`);
      if(--remaining < 0) { clearInterval(timer); $("#timer").text("Link expired"); $("#btnReset").prop('disabled',true); }
    },1000);

    $("#btnReset").click(function(){
      $.ajax({
        url:'/Account/ValidateResetToken?token='+token,
        method:'GET',
        success:r=>{
          if(!r.success){ alert(r.message); return; }
          $.ajax({
            url:'/Account/ResetPassword',
            method:'POST',
            data:JSON.stringify({  NewPassword:$("#newPwd").val(), token }),
            contentType:'application/json',
            success:resp=>alert(resp.message)
          });
        }
      });
    });
</script>
